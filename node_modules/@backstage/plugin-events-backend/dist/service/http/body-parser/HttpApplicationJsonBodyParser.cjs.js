'use strict';

var errors = require('../errors.cjs.js');

const HttpApplicationJsonBodyParser = async (request, parsedMediaType, topic) => {
  const requestBody = request.body;
  if (!Buffer.isBuffer(requestBody)) {
    throw new Error(
      `Failed to retrieve raw body from incoming event for topic ${topic}; not a buffer: ${typeof requestBody}`
    );
  }
  const bodyBuffer = requestBody;
  const encoding = parsedMediaType.parameters.charset ?? "utf-8";
  if (!Buffer.isEncoding(encoding)) {
    throw new errors.UnsupportedCharsetError(encoding);
  }
  const bodyString = bodyBuffer.toString(encoding);
  const bodyParsed = parsedMediaType.type === "application/json" ? JSON.parse(bodyString) : bodyString;
  return { bodyParsed, bodyBuffer, encoding };
};

exports.HttpApplicationJsonBodyParser = HttpApplicationJsonBodyParser;
//# sourceMappingURL=HttpApplicationJsonBodyParser.cjs.js.map
