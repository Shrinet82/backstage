{"version":3,"file":"HttpApplicationJsonBodyParser.cjs.js","sources":["../../../../src/service/http/body-parser/HttpApplicationJsonBodyParser.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { HttpBodyParser } from '@backstage/plugin-events-node';\nimport { UnsupportedCharsetError } from '../errors';\n\nexport const HttpApplicationJsonBodyParser: HttpBodyParser = async (\n  request,\n  parsedMediaType,\n  topic,\n) => {\n  const requestBody = request.body;\n  if (!Buffer.isBuffer(requestBody)) {\n    throw new Error(\n      `Failed to retrieve raw body from incoming event for topic ${topic}; not a buffer: ${typeof requestBody}`,\n    );\n  }\n\n  const bodyBuffer: Buffer = requestBody;\n\n  const encoding = parsedMediaType.parameters.charset ?? 'utf-8';\n  if (!Buffer.isEncoding(encoding)) {\n    throw new UnsupportedCharsetError(encoding);\n  }\n\n  const bodyString = bodyBuffer.toString(encoding);\n  const bodyParsed =\n    parsedMediaType.type === 'application/json'\n      ? JSON.parse(bodyString)\n      : bodyString;\n  return { bodyParsed, bodyBuffer, encoding };\n};\n"],"names":["UnsupportedCharsetError"],"mappings":";;;;AAkBO,MAAM,6BAAA,GAAgD,OAC3D,OAAA,EACA,eAAA,EACA,KAAA,KACG;AACH,EAAA,MAAM,cAAc,OAAA,CAAQ,IAAA;AAC5B,EAAA,IAAI,CAAC,MAAA,CAAO,QAAA,CAAS,WAAW,CAAA,EAAG;AACjC,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA,0DAAA,EAA6D,KAAK,CAAA,gBAAA,EAAmB,OAAO,WAAW,CAAA;AAAA,KACzG;AAAA,EACF;AAEA,EAAA,MAAM,UAAA,GAAqB,WAAA;AAE3B,EAAA,MAAM,QAAA,GAAW,eAAA,CAAgB,UAAA,CAAW,OAAA,IAAW,OAAA;AACvD,EAAA,IAAI,CAAC,MAAA,CAAO,UAAA,CAAW,QAAQ,CAAA,EAAG;AAChC,IAAA,MAAM,IAAIA,+BAAwB,QAAQ,CAAA;AAAA,EAC5C;AAEA,EAAA,MAAM,UAAA,GAAa,UAAA,CAAW,QAAA,CAAS,QAAQ,CAAA;AAC/C,EAAA,MAAM,aACJ,eAAA,CAAgB,IAAA,KAAS,qBACrB,IAAA,CAAK,KAAA,CAAM,UAAU,CAAA,GACrB,UAAA;AACN,EAAA,OAAO,EAAE,UAAA,EAAY,UAAA,EAAY,QAAA,EAAS;AAC5C;;;;"}