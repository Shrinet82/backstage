{"version":3,"file":"GithubEntityProvider.cjs.js","sources":["../../src/providers/GithubEntityProvider.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport {\n  GithubAppCredentialsMux,\n  GithubCredentialsProvider,\n  GithubIntegration,\n  GithubIntegrationConfig,\n  ScmIntegrations,\n  SingleInstanceGithubCredentialsProvider,\n} from '@backstage/integration';\nimport {\n  DeferredEntity,\n  EntityProvider,\n  EntityProviderConnection,\n  locationSpecToLocationEntity,\n} from '@backstage/plugin-catalog-node';\n\nimport { LocationSpec } from '@backstage/plugin-catalog-common';\n\nimport { graphql } from '@octokit/graphql';\nimport * as uuid from 'uuid';\nimport {\n  GithubEntityProviderConfig,\n  readProviderConfigs,\n} from './GithubEntityProviderConfig';\nimport {\n  getOrganizationRepositories,\n  getOrganizationRepository,\n  RepositoryResponse,\n  GithubPageSizes,\n  DEFAULT_PAGE_SIZES,\n} from '../lib/github';\nimport {\n  satisfiesForkFilter,\n  satisfiesTopicFilter,\n  satisfiesVisibilityFilter,\n} from '../lib/util';\n\nimport {\n  EventParams,\n  EventsService,\n  EventSubscriber,\n} from '@backstage/plugin-events-node';\nimport {\n  Commit,\n  PushEvent,\n  RepositoryArchivedEvent,\n  RepositoryDeletedEvent,\n  RepositoryEditedEvent,\n  RepositoryEvent,\n  RepositoryRenamedEvent,\n  RepositoryTransferredEvent,\n  RepositoryUnarchivedEvent,\n} from '@octokit/webhooks-types';\nimport { Minimatch } from 'minimatch';\nimport {\n  LoggerService,\n  SchedulerService,\n  SchedulerServiceTaskRunner,\n} from '@backstage/backend-plugin-api';\n\nconst EVENT_TOPICS = ['github.push', 'github.repository'];\n\ntype Repository = {\n  name: string;\n  url: string;\n  isArchived: boolean;\n  isFork: boolean;\n  repositoryTopics: string[];\n  defaultBranchRef?: string;\n  isCatalogInfoFilePresent: boolean;\n  visibility: string;\n  organization: string;\n};\n\n/**\n * Discovers catalog files located in [GitHub](https://github.com).\n * The provider will search your GitHub account and register catalog files matching the configured path\n * as Location entity and via following processing steps add all contained catalog entities.\n * This can be useful as an alternative to static locations or manually adding things to the catalog.\n *\n * @public\n */\nexport class GithubEntityProvider implements EntityProvider, EventSubscriber {\n  private readonly config: GithubEntityProviderConfig;\n  private readonly events?: EventsService;\n  private readonly logger: LoggerService;\n  private readonly integration: GithubIntegrationConfig;\n  private readonly scheduleFn: () => Promise<void>;\n  private connection?: EntityProviderConnection;\n  private readonly githubCredentialsProvider: GithubCredentialsProvider;\n\n  static fromConfig(\n    config: Config,\n    options: {\n      events?: EventsService;\n      logger: LoggerService;\n      schedule?: SchedulerServiceTaskRunner;\n      scheduler?: SchedulerService;\n    },\n  ): GithubEntityProvider[] {\n    if (!options.schedule && !options.scheduler) {\n      throw new Error('Either schedule or scheduler must be provided.');\n    }\n\n    const integrations = ScmIntegrations.fromConfig(config);\n\n    return readProviderConfigs(config).map(providerConfig => {\n      const integrationHost = providerConfig.host;\n      const integration = integrations.github.byHost(integrationHost);\n\n      if (!integration) {\n        throw new Error(\n          `There is no GitHub config that matches host ${integrationHost}. Please add a configuration entry for it under integrations.github`,\n        );\n      }\n\n      const taskRunner =\n        options.schedule ??\n        options.scheduler!.createScheduledTaskRunner(providerConfig.schedule!);\n\n      return new GithubEntityProvider(\n        providerConfig,\n        integration,\n        options.logger,\n        taskRunner,\n        options.events,\n      );\n    });\n  }\n\n  private constructor(\n    config: GithubEntityProviderConfig,\n    integration: GithubIntegration,\n    logger: LoggerService,\n    taskRunner: SchedulerServiceTaskRunner,\n    events?: EventsService,\n  ) {\n    this.config = config;\n    this.events = events;\n    this.integration = integration.config;\n    this.logger = logger.child({\n      target: this.getProviderName(),\n    });\n    this.scheduleFn = this.createScheduleFn(taskRunner);\n    this.githubCredentialsProvider =\n      SingleInstanceGithubCredentialsProvider.create(integration.config);\n  }\n\n  /** {@inheritdoc @backstage/plugin-catalog-node#EntityProvider.getProviderName} */\n  getProviderName(): string {\n    return `github-provider:${this.config.id}`;\n  }\n\n  /** {@inheritdoc @backstage/plugin-catalog-node#EntityProvider.connect} */\n  async connect(connection: EntityProviderConnection): Promise<void> {\n    this.connection = connection;\n    await this.events?.subscribe({\n      id: this.getProviderName(),\n      topics: EVENT_TOPICS,\n      onEvent: params => this.onEvent(params),\n    });\n    return await this.scheduleFn();\n  }\n\n  private createScheduleFn(\n    taskRunner: SchedulerServiceTaskRunner,\n  ): () => Promise<void> {\n    return async () => {\n      const taskId = `${this.getProviderName()}:refresh`;\n      return taskRunner.run({\n        id: taskId,\n        fn: async () => {\n          const logger = this.logger.child({\n            class: GithubEntityProvider.prototype.constructor.name,\n            taskId,\n            taskInstanceId: uuid.v4(),\n          });\n          try {\n            await this.refresh(logger);\n          } catch (error) {\n            logger.error(\n              `${this.getProviderName()} refresh failed, ${error}`,\n              error,\n            );\n          }\n        },\n      });\n    };\n  }\n\n  async refresh(logger: LoggerService) {\n    if (!this.connection) {\n      throw new Error('Not initialized');\n    }\n\n    const targets = await this.findCatalogFiles();\n    const matchingTargets = this.matchesFilters(targets);\n    const entities = this.toDeferredEntitiesFromRepos(matchingTargets);\n\n    await this.connection.applyMutation({\n      type: 'full',\n      entities,\n    });\n\n    logger.info(\n      `Read ${targets.length} GitHub repositories (${entities.length} matching the pattern)`,\n    );\n  }\n\n  private async getOrganizations(): Promise<string[]> {\n    if (this.config.organization) return [this.config.organization];\n\n    const githubAppMux = new GithubAppCredentialsMux(this.integration, [\n      this.config.app!,\n    ]);\n    const installs = await githubAppMux.getAllInstallations();\n    return installs\n      .map(install =>\n        install.target_type === 'Organization' &&\n        install.account &&\n        'login' in install.account\n          ? install.account.login\n          : undefined,\n      )\n      .filter(Boolean) as string[];\n  }\n\n  private async createGraphqlClient(organization: string) {\n    const host = this.integration.host;\n    const orgUrl = `https://${host}/${organization}`;\n\n    const { headers } = await this.githubCredentialsProvider.getCredentials({\n      url: orgUrl,\n    });\n\n    return graphql.defaults({\n      baseUrl: this.integration.apiBaseUrl,\n      headers,\n    });\n  }\n\n  // go to the server and get all repositories\n  private async findCatalogFiles(): Promise<Repository[]> {\n    const organizations = await this.getOrganizations();\n    const catalogPath = this.config.catalogPath;\n\n    let repositories: Repository[] = [];\n    for (const organization of organizations) {\n      const client = await this.createGraphqlClient(organization);\n\n      const pageSizes: GithubPageSizes = {\n        ...DEFAULT_PAGE_SIZES,\n        ...this.config.pageSizes,\n      };\n\n      const { repositories: repositoriesFromGithub } =\n        await getOrganizationRepositories(\n          client,\n          organization,\n          catalogPath,\n          pageSizes,\n        );\n      repositories = repositories.concat(\n        repositoriesFromGithub.map(r =>\n          this.createRepoFromGithubResponse(r, organization),\n        ),\n      );\n    }\n\n    if (this.config.validateLocationsExist) {\n      return repositories.filter(\n        repository => repository.isCatalogInfoFilePresent,\n      );\n    }\n\n    return repositories;\n  }\n\n  private matchesFilters(repositories: Repository[]): Repository[] {\n    const repositoryFilter = this.config.filters.repository;\n    const topicFilters = this.config.filters.topic;\n    const allowForks = this.config.filters.allowForks;\n    const visibilities = this.config.filters.visibility ?? [];\n    const allowArchived = this.config.filters.allowArchived;\n\n    return repositories.filter(r => {\n      const repoTopics: string[] = r.repositoryTopics;\n      return (\n        (allowArchived || !r.isArchived) &&\n        (!repositoryFilter || repositoryFilter.test(r.name)) &&\n        satisfiesTopicFilter(repoTopics, topicFilters) &&\n        satisfiesForkFilter(allowForks, r.isFork) &&\n        satisfiesVisibilityFilter(visibilities, r.visibility) &&\n        r.defaultBranchRef\n      );\n    });\n  }\n\n  private createLocationUrl(repository: Repository): string {\n    const branch =\n      this.config.filters.branch || repository.defaultBranchRef || '-';\n    const catalogFile = this.config.catalogPath.startsWith('/')\n      ? this.config.catalogPath.substring(1)\n      : this.config.catalogPath;\n    return `${repository.url}/blob/${branch}/${catalogFile}`;\n  }\n\n  private static toLocationSpec(target: string): LocationSpec {\n    return {\n      type: 'url',\n      target: target,\n      presence: 'optional',\n    };\n  }\n\n  /** {@inheritdoc @backstage/plugin-events-node#EventSubscriber.onEvent} */\n  async onEvent(params: EventParams): Promise<void> {\n    this.logger.debug(`Received event for topic ${params.topic}`);\n    if (EVENT_TOPICS.some(topic => topic === params.topic)) {\n      if (!this.connection) {\n        throw new Error('Not initialized');\n      }\n\n      switch (params.topic) {\n        case 'github.push':\n          await this.onPush(params.eventPayload as PushEvent);\n          return;\n\n        case 'github.repository':\n          await this.onRepoChange(params.eventPayload as RepositoryEvent);\n          return;\n\n        default: // should never be reached\n          this.logger.warn(\n            `Missing implementation for event of topic ${params.topic}`,\n          );\n      }\n    }\n  }\n\n  /** {@inheritdoc @backstage/plugin-events-node#EventSubscriber.supportsEventTopics} */\n  supportsEventTopics(): string[] {\n    return EVENT_TOPICS;\n  }\n\n  private async onPush(event: PushEvent) {\n    const configOrganizations = (await this.getOrganizations()).map(org =>\n      org.toLocaleLowerCase('en-US'),\n    );\n    const eventOrganization =\n      event.organization?.login.toLocaleLowerCase('en-US');\n\n    if (\n      !eventOrganization ||\n      !configOrganizations.includes(eventOrganization)\n    ) {\n      this.logger.debug(\n        `skipping push event from organization ${event.organization?.login}`,\n      );\n      return;\n    }\n\n    const repoName = event.repository.name;\n    const repoUrl = event.repository.html_url;\n    this.logger.debug(`handle github:push event for ${repoName} - ${repoUrl}`);\n\n    const branch =\n      this.config.filters.branch || event.repository.default_branch;\n\n    if (event.ref !== `refs/heads/${branch}`) {\n      this.logger.debug(`skipping push event from ref ${event.ref}`);\n      return;\n    }\n\n    const repository = this.createRepoFromEvent(event);\n\n    const matchingTargets = this.matchesFilters([repository]);\n    if (matchingTargets.length === 0) {\n      this.logger.debug(\n        `skipping push event from repository ${repoName} because didn't match provider filters`,\n      );\n      return;\n    }\n\n    // the commit has information about the files (added,removed,modified)\n    // so we will process the change based in this data\n    // https://docs.github.com/en/developers/webhooks-and-events/webhooks/webhook-events-and-payloads#push\n    const added = this.collectDeferredEntitiesFromCommit(\n      repoUrl,\n      branch,\n      event.commits,\n      (commit: Commit) => [...commit.added],\n    );\n    const removed = this.collectDeferredEntitiesFromCommit(\n      repoUrl,\n      branch,\n      event.commits,\n      (commit: Commit) => [...commit.removed],\n    );\n    const modified = this.collectFilesFromCommit(\n      event.commits,\n      (commit: Commit) => [...commit.modified],\n    );\n\n    if (modified.length > 0) {\n      const catalogPath = this.config.catalogPath.startsWith('/')\n        ? this.config.catalogPath.substring(1)\n        : this.config.catalogPath;\n\n      await this.connection!.refresh({\n        keys: [\n          ...new Set([\n            ...modified.map(\n              filePath => `url:${repoUrl}/tree/${branch}/${filePath}`,\n            ),\n            ...modified.map(\n              filePath => `url:${repoUrl}/blob/${branch}/${filePath}`,\n            ),\n            `url:${repoUrl}/tree/${branch}/${catalogPath}`,\n          ]),\n        ],\n      });\n    }\n\n    if (added.length > 0 || removed.length > 0) {\n      await this.connection!.applyMutation({\n        type: 'delta',\n        added: added,\n        removed: removed,\n      });\n    }\n\n    this.logger.info(\n      `Processed Github push event: added ${added.length} - removed ${removed.length} - modified ${modified.length}`,\n    );\n  }\n\n  private async onRepoChange(event: RepositoryEvent) {\n    const configOrganizations = (await this.getOrganizations()).map(org =>\n      org.toLocaleLowerCase('en-US'),\n    );\n    const eventOrganization =\n      event.organization?.login.toLocaleLowerCase('en-US');\n\n    if (\n      !eventOrganization ||\n      !configOrganizations.includes(eventOrganization)\n    ) {\n      this.logger.debug(\n        `skipping repository event from organization ${event.organization?.login}`,\n      );\n      return;\n    }\n\n    const action = event.action;\n    switch (action) {\n      case 'archived':\n        await this.onRepoArchived(event as RepositoryArchivedEvent);\n        return;\n\n      // A repository was created.\n      case 'created':\n        // skip these events\n        return;\n\n      case 'deleted':\n        await this.onRepoDeleted(event as RepositoryDeletedEvent);\n        return;\n\n      case 'edited':\n        await this.onRepoEdited(event as RepositoryEditedEvent);\n        return;\n\n      // The visibility of a repository was changed to `private`.\n      case 'privatized':\n        // skip these events\n        return;\n\n      // The visibility of a repository was changed to `public`.\n      case 'publicized':\n        // skip these events\n        return;\n\n      case 'renamed':\n        await this.onRepoRenamed(event as RepositoryRenamedEvent);\n        return;\n\n      case 'transferred':\n        await this.onRepoTransferred(event as RepositoryTransferredEvent);\n        return;\n\n      case 'unarchived':\n        await this.onRepoUnarchived(event as RepositoryUnarchivedEvent);\n        return;\n\n      default: // should never be reached\n        this.logger.warn(\n          `Missing implementation for event of topic repository with action ${action}`,\n        );\n    }\n  }\n\n  /**\n   * A repository was archived.\n   *\n   * Removes all entities associated with the repository.\n   *\n   * @param event - The repository archived event.\n   */\n  private async onRepoArchived(event: RepositoryArchivedEvent) {\n    if (this.config.filters.allowArchived) return;\n\n    const repository = this.createRepoFromEvent(event);\n    await this.removeEntitiesForRepo(repository);\n    this.logger.debug(\n      `Removed entities for archived repository ${repository.name}`,\n    );\n  }\n\n  /**\n   * A repository was deleted.\n   *\n   * Removes all entities associated with the repository.\n   *\n   * @param event - The repository deleted event.\n   */\n  private async onRepoDeleted(event: RepositoryDeletedEvent) {\n    const repository = this.createRepoFromEvent(event);\n    await this.removeEntitiesForRepo(repository);\n    this.logger.debug(\n      `Removed entities for deleted repository ${repository.name}`,\n    );\n  }\n\n  /**\n   * The topics, default branch, description, or homepage of a repository was changed.\n   *\n   * We are interested in potential topic changes as these can be used as part of the filters.\n   *\n   * Removes all entities associated with the repository if the repository no longer matches the filters.\n   *\n   * @param event - The repository edited event.\n   */\n  private async onRepoEdited(event: RepositoryEditedEvent) {\n    const repository = this.createRepoFromEvent(event);\n\n    const matchingTargets = this.matchesFilters([repository]);\n    if (matchingTargets.length === 0) {\n      await this.removeEntitiesForRepo(repository);\n    }\n    // else: repository is (still) matching the filters, so we don't need to do anything\n  }\n\n  /**\n   * The name of a repository was changed.\n   *\n   * Removes all entities associated with the repository's old name.\n   * Creates new entities for the repository's new name if it still matches the filters.\n   *\n   * @param event - The repository renamed event.\n   */\n  private async onRepoRenamed(event: RepositoryRenamedEvent) {\n    const repository = this.createRepoFromEvent(event);\n    const oldRepoName = event.changes.repository.name.from;\n    const urlParts = repository.url.split('/');\n    urlParts[urlParts.length - 1] = oldRepoName;\n    const oldRepoUrl = urlParts.join('/');\n    const oldRepository: Repository = {\n      ...repository,\n      name: oldRepoName,\n      url: oldRepoUrl,\n    };\n    await this.removeEntitiesForRepo(oldRepository);\n\n    const matchingTargets = this.matchesFilters([repository]);\n    if (matchingTargets.length === 0) {\n      this.logger.debug(\n        `skipping repository renamed event for repository ${repository.name} because it didn't match provider filters`,\n      );\n      return;\n    }\n\n    await this.addEntitiesForRepo(repository);\n  }\n\n  /**\n   * Ownership of the repository was transferred to a user or organization account.\n   * This event is only sent to the account where the ownership is transferred.\n   * To receive the `repository.transferred` event, the new owner account must have the GitHub App installed,\n   * and the App must be subscribed to \"Repository\" events.\n   *\n   * Creates new entities for the repository if it matches the filters.\n   *\n   * @param event - The repository transferred event.\n   */\n  private async onRepoTransferred(event: RepositoryTransferredEvent) {\n    const repository = this.createRepoFromEvent(event);\n\n    const matchingTargets = this.matchesFilters([repository]);\n    if (matchingTargets.length === 0) {\n      this.logger.debug(\n        `skipping repository transferred event for repository ${repository.name} because it didn't match provider filters`,\n      );\n      return;\n    }\n\n    await this.addEntitiesForRepo(repository);\n  }\n\n  /**\n   * A previously archived repository was unarchived.\n   *\n   * Creates new entities for the repository if it matches the filters.\n   *\n   * @param event - The repository unarchived event.\n   */\n  private async onRepoUnarchived(event: RepositoryUnarchivedEvent) {\n    const repository = this.createRepoFromEvent(event);\n\n    const matchingTargets = this.matchesFilters([repository]);\n    if (matchingTargets.length === 0) {\n      this.logger.debug(\n        `skipping repository unarchived event for repository ${repository.name} because it didn't match provider filters`,\n      );\n      return;\n    }\n\n    await this.addEntitiesForRepo(repository);\n  }\n\n  private async removeEntitiesForRepo(repository: Repository) {\n    const removed = this.toDeferredEntitiesFromRepos([repository]);\n    await this.connection!.applyMutation({\n      type: 'delta',\n      added: [],\n      removed: removed,\n    });\n  }\n\n  private async addEntitiesForRepo(repository: Repository) {\n    if (this.config.validateLocationsExist) {\n      const organization = repository.organization;\n      const catalogPath = this.config.catalogPath;\n      const client = await this.createGraphqlClient(organization);\n\n      const repositoryFromGithub = await getOrganizationRepository(\n        client,\n        organization,\n        repository.name,\n        catalogPath,\n      ).then(r =>\n        r ? this.createRepoFromGithubResponse(r, organization) : null,\n      );\n\n      if (!repositoryFromGithub?.isCatalogInfoFilePresent) {\n        return;\n      }\n    }\n\n    const added = this.toDeferredEntitiesFromRepos([repository]);\n    await this.connection!.applyMutation({\n      type: 'delta',\n      added: added,\n      removed: [],\n    });\n  }\n\n  private createRepoFromEvent(event: RepositoryEvent | PushEvent): Repository {\n    return {\n      // $.repository.url can be a value like\n      // \"https://api.github.com/repos/{org}/{repo}\"\n      // or \"https://github.com/{org}/{repo}\"\n      url: event.repository.html_url,\n      name: event.repository.name,\n      defaultBranchRef: event.repository.default_branch,\n      repositoryTopics: event.repository.topics,\n      isArchived: event.repository.archived,\n      isFork: event.repository.fork,\n      // we can consider this file present because\n      // only the catalog file will be recovered from the commits\n      isCatalogInfoFilePresent: true,\n      visibility: event.repository.visibility,\n      organization: event.repository.owner.login,\n    };\n  }\n\n  private createRepoFromGithubResponse(\n    repositoryResponse: RepositoryResponse,\n    organization: string,\n  ): Repository {\n    return {\n      url: repositoryResponse.url,\n      name: repositoryResponse.name,\n      defaultBranchRef: repositoryResponse.defaultBranchRef?.name,\n      repositoryTopics: repositoryResponse.repositoryTopics.nodes.map(\n        t => t.topic.name,\n      ),\n      isArchived: repositoryResponse.isArchived,\n      isFork: repositoryResponse.isFork,\n      isCatalogInfoFilePresent:\n        repositoryResponse.catalogInfoFile?.__typename === 'Blob' &&\n        repositoryResponse.catalogInfoFile.text !== '',\n      visibility: repositoryResponse.visibility,\n      organization,\n    };\n  }\n\n  private collectDeferredEntitiesFromCommit(\n    repositoryUrl: string,\n    branch: string,\n    commits: Commit[],\n    transformOperation: (commit: Commit) => string[],\n  ): DeferredEntity[] {\n    const catalogFiles = this.collectFilesFromCommit(\n      commits,\n      transformOperation,\n    );\n    return this.toDeferredEntities(\n      catalogFiles.map(\n        filePath => `${repositoryUrl}/blob/${branch}/${filePath}`,\n      ),\n    );\n  }\n\n  private collectFilesFromCommit(\n    commits: Commit[],\n    transformOperation: (commit: Commit) => string[],\n  ): string[] {\n    const catalogFile = this.config.catalogPath.startsWith('/')\n      ? this.config.catalogPath.substring(1)\n      : this.config.catalogPath;\n\n    const matcher = new Minimatch(catalogFile);\n    return commits\n      .map(transformOperation)\n      .flat()\n      .filter(file => matcher.match(file));\n  }\n\n  private toDeferredEntities(targets: string[]): DeferredEntity[] {\n    return targets\n      .map(target => {\n        const location = GithubEntityProvider.toLocationSpec(target);\n\n        return locationSpecToLocationEntity({ location });\n      })\n      .map(entity => {\n        return {\n          locationKey: this.getProviderName(),\n          entity: entity,\n        };\n      });\n  }\n\n  private toDeferredEntitiesFromRepos(\n    repositories: Repository[],\n  ): DeferredEntity[] {\n    return repositories\n      .map(repository => this.createLocationUrl(repository))\n      .map(GithubEntityProvider.toLocationSpec)\n      .map(location => {\n        return {\n          locationKey: this.getProviderName(),\n          entity: locationSpecToLocationEntity({ location }),\n        };\n      });\n  }\n}\n\n/*\n * Helpers\n */\n\nexport function parseUrl(urlString: string): {\n  org: string;\n  repoSearchPath: RegExp;\n  catalogPath: string;\n  branch: string;\n  host: string;\n} {\n  const url = new URL(urlString);\n  const path = url.pathname.slice(1).split('/');\n\n  // /backstage/techdocs-*/blob/master/catalog-info.yaml\n  // can also be\n  // /backstage\n  if (path.length > 2 && path[0].length && path[1].length) {\n    return {\n      org: decodeURIComponent(path[0]),\n      repoSearchPath: escapeRegExp(decodeURIComponent(path[1])),\n      catalogPath: `/${decodeURIComponent(path.slice(4).join('/'))}`,\n      branch: decodeURIComponent(path[3]),\n      host: url.host,\n    };\n  } else if (path.length === 1 && path[0].length) {\n    return {\n      org: decodeURIComponent(path[0]),\n      repoSearchPath: escapeRegExp('*'),\n      catalogPath: '/catalog-info.yaml',\n      branch: '-',\n      host: url.host,\n    };\n  }\n\n  throw new Error(`Failed to parse ${urlString}`);\n}\n\nexport function escapeRegExp(str: string): RegExp {\n  return new RegExp(`^${str.replace(/\\*/g, '.*')}$`);\n}\n"],"names":["ScmIntegrations","readProviderConfigs","integration","SingleInstanceGithubCredentialsProvider","uuid","GithubAppCredentialsMux","graphql","DEFAULT_PAGE_SIZES","getOrganizationRepositories","satisfiesTopicFilter","satisfiesForkFilter","satisfiesVisibilityFilter","getOrganizationRepository","Minimatch","locationSpecToLocationEntity"],"mappings":"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"}