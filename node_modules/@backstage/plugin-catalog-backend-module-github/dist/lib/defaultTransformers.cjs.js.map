{"version":3,"file":"defaultTransformers.cjs.js","sources":["../../src/lib/defaultTransformers.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity, GroupEntity, UserEntity } from '@backstage/catalog-model';\nimport { graphql } from '@octokit/graphql';\nimport {\n  ANNOTATION_GITHUB_TEAM_SLUG,\n  ANNOTATION_GITHUB_USER_LOGIN,\n} from './annotation';\nimport { GithubTeam, GithubUser } from './github';\n\n/**\n * Context passed to Transformers\n *\n * @public\n */\nexport interface TransformerContext {\n  client: typeof graphql;\n  query: string;\n  org: string;\n}\n\n/**\n * Transformer for GitHub users to an Entity\n *\n * @public\n */\nexport type UserTransformer = (\n  item: GithubUser,\n  ctx: TransformerContext,\n) => Promise<Entity | undefined>;\n\n/**\n * Transformer for GitHub Team to an Entity\n *\n * @public\n */\nexport type TeamTransformer = (\n  item: GithubTeam,\n  ctx: TransformerContext,\n) => Promise<Entity | undefined>;\n\n/**\n * Default transformer for GitHub users to UserEntity\n *\n * @public\n */\nexport const defaultUserTransformer = async (\n  item: GithubUser,\n  _ctx: TransformerContext,\n): Promise<UserEntity | undefined> => {\n  const entity: UserEntity = {\n    apiVersion: 'backstage.io/v1alpha1',\n    kind: 'User',\n    metadata: {\n      name: item.login,\n      annotations: {\n        [ANNOTATION_GITHUB_USER_LOGIN]: item.login,\n      },\n    },\n    spec: {\n      profile: {},\n      memberOf: [],\n    },\n  };\n\n  if (item.bio) entity.metadata.description = item.bio;\n  if (item.name) entity.spec.profile!.displayName = item.name;\n  if (item.email) entity.spec.profile!.email = item.email;\n  if (item.avatarUrl) entity.spec.profile!.picture = item.avatarUrl;\n  return entity;\n};\n\n/**\n * Default transformer for GitHub Team to GroupEntity\n *\n * @public\n */\nexport const defaultOrganizationTeamTransformer: TeamTransformer =\n  async team => {\n    const annotations: { [annotationName: string]: string } = {\n      [ANNOTATION_GITHUB_TEAM_SLUG]: team.combinedSlug,\n    };\n\n    if (team.editTeamUrl) {\n      annotations['backstage.io/edit-url'] = team.editTeamUrl;\n    }\n\n    const entity: GroupEntity = {\n      apiVersion: 'backstage.io/v1alpha1',\n      kind: 'Group',\n      metadata: {\n        name: team.slug,\n        annotations,\n      },\n      spec: {\n        type: 'team',\n        profile: {},\n        children: [],\n      },\n    };\n\n    if (team.description) {\n      entity.metadata.description = team.description;\n    }\n    if (team.name) {\n      entity.spec.profile!.displayName = team.name;\n    }\n    if (team.avatarUrl) {\n      entity.spec.profile!.picture = team.avatarUrl;\n    }\n    if (team.parentTeam) {\n      entity.spec.parent = team.parentTeam.slug;\n    }\n\n    entity.spec.members = team.members.map(user => user.login);\n\n    return entity;\n  };\n"],"names":["ANNOTATION_GITHUB_USER_LOGIN","ANNOTATION_GITHUB_TEAM_SLUG"],"mappings":";;;;AA4DO,MAAM,sBAAA,GAAyB,OACpC,IAAA,EACA,IAAA,KACoC;AACpC,EAAA,MAAM,MAAA,GAAqB;AAAA,IACzB,UAAA,EAAY,uBAAA;AAAA,IACZ,IAAA,EAAM,MAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,MAAM,IAAA,CAAK,KAAA;AAAA,MACX,WAAA,EAAa;AAAA,QACX,CAACA,uCAA4B,GAAG,IAAA,CAAK;AAAA;AACvC,KACF;AAAA,IACA,IAAA,EAAM;AAAA,MACJ,SAAS,EAAC;AAAA,MACV,UAAU;AAAC;AACb,GACF;AAEA,EAAA,IAAI,IAAA,CAAK,GAAA,EAAK,MAAA,CAAO,QAAA,CAAS,cAAc,IAAA,CAAK,GAAA;AACjD,EAAA,IAAI,KAAK,IAAA,EAAM,MAAA,CAAO,IAAA,CAAK,OAAA,CAAS,cAAc,IAAA,CAAK,IAAA;AACvD,EAAA,IAAI,KAAK,KAAA,EAAO,MAAA,CAAO,IAAA,CAAK,OAAA,CAAS,QAAQ,IAAA,CAAK,KAAA;AAClD,EAAA,IAAI,KAAK,SAAA,EAAW,MAAA,CAAO,IAAA,CAAK,OAAA,CAAS,UAAU,IAAA,CAAK,SAAA;AACxD,EAAA,OAAO,MAAA;AACT;AAOO,MAAM,kCAAA,GACX,OAAM,IAAA,KAAQ;AACZ,EAAA,MAAM,WAAA,GAAoD;AAAA,IACxD,CAACC,sCAA2B,GAAG,IAAA,CAAK;AAAA,GACtC;AAEA,EAAA,IAAI,KAAK,WAAA,EAAa;AACpB,IAAA,WAAA,CAAY,uBAAuB,IAAI,IAAA,CAAK,WAAA;AAAA,EAC9C;AAEA,EAAA,MAAM,MAAA,GAAsB;AAAA,IAC1B,UAAA,EAAY,uBAAA;AAAA,IACZ,IAAA,EAAM,OAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,MAAM,IAAA,CAAK,IAAA;AAAA,MACX;AAAA,KACF;AAAA,IACA,IAAA,EAAM;AAAA,MACJ,IAAA,EAAM,MAAA;AAAA,MACN,SAAS,EAAC;AAAA,MACV,UAAU;AAAC;AACb,GACF;AAEA,EAAA,IAAI,KAAK,WAAA,EAAa;AACpB,IAAA,MAAA,CAAO,QAAA,CAAS,cAAc,IAAA,CAAK,WAAA;AAAA,EACrC;AACA,EAAA,IAAI,KAAK,IAAA,EAAM;AACb,IAAA,MAAA,CAAO,IAAA,CAAK,OAAA,CAAS,WAAA,GAAc,IAAA,CAAK,IAAA;AAAA,EAC1C;AACA,EAAA,IAAI,KAAK,SAAA,EAAW;AAClB,IAAA,MAAA,CAAO,IAAA,CAAK,OAAA,CAAS,OAAA,GAAU,IAAA,CAAK,SAAA;AAAA,EACtC;AACA,EAAA,IAAI,KAAK,UAAA,EAAY;AACnB,IAAA,MAAA,CAAO,IAAA,CAAK,MAAA,GAAS,IAAA,CAAK,UAAA,CAAW,IAAA;AAAA,EACvC;AAEA,EAAA,MAAA,CAAO,KAAK,OAAA,GAAU,IAAA,CAAK,QAAQ,GAAA,CAAI,CAAA,IAAA,KAAQ,KAAK,KAAK,CAAA;AAEzD,EAAA,OAAO,MAAA;AACT;;;;;"}